{% for reply in replies %}
    <div class="card mt-3">
        <div class="card-body">
            <h5 class="card-title">{{ reply.username|escape }}</h5>
            <h6 class="card-subtitle mb-2 text-muted">{{ reply.email|escape }}</h6>
            <p class="card-text">{{ reply.text|safe }}</p>
            {% if reply.image %}
                <!-- Используйте ссылку с атрибутом data-lightbox для активации Lightbox2 -->
                <a href="{{ reply.image.url }}" data-lightbox="reply-images" data-title="Reply from {{ reply.username }}">
                    <img src="{{ reply.image.url }}" alt="Reply image" class="img-fluid mb-3" style="max-width: 100%; max-height: 240px;" />
                </a>
            {% endif %}
            <footer class="blockquote-footer"><cite title="Source Title">{{ reply.created_at }}</cite></footer>
            
            <!-- Кнопка для отображения формы ответа -->
            <button type="button" class="btn btn-primary" onclick="toggleReplyForm('{{ reply.id }}')">Ответить</button>

            <!-- Форма для добавления ответа -->
            <div id="reply-form-{{ reply.id }}" class="reply-form mt-3">
                <form method="post" enctype="multipart/form-data" action="{% url 'add_reply' reply.id %}">
                    {% csrf_token %}
                    {{ form.as_p }}
                    <button type="submit" class="btn btn-primary">Отправить</button>
                </form>
            </div>

            <!-- Рекурсивное отображение ответов -->
            <div class="mt-3">
                {% include 'comments/replies.html' with replies=reply.replies.all %}
            </div>
        </div>
    </div>
{% empty %}
    <p>Нет ответов</p>
{% endfor %}
